import{r as c,G,H,k as W,w as A,f as J,c as p,a as t,h as o,u as l,F as L,g as T,q as b,j as v,o as u,p as K,t as x,n as Q}from"./index-DorqM7ya.js";import{s as X}from"./index-CU9Tc1Gi.js";import{s as n}from"./index-DMRAzI-C.js";import{u as Y,s as Z}from"./eventSource-qZHBCGZS.js";import{s as R}from"./index-CNP9W4VC.js";import{s as V}from"./index-DEJ4SokQ.js";import{s as C}from"./index-Bv3rf-LS.js";import{s as N}from"./index-CyRPQyA5.js";import{s as ee}from"./index-DQW9hGmH.js";import{s as se}from"./index-DSlDG1eH.js";import{s as te}from"./index-C7zoCffc.js";import"./index-ChQ6boSU.js";import"./index-C2nGUy0j.js";import"./index-CII8oppT.js";import"./index-CiwNahGm.js";import"./index-BX33RUWu.js";import"./index-DJUY68fS.js";const le={class:"p-4 flex flex-col gap-4"},ae={class:"flex justify-between items-center mb-4"},oe={class:"flex gap-2"},ie={key:0,class:"flex justify-center"},re={key:1,class:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4"},ne={class:"flex justify-between items-center"},de=["title"],ue={class:"flex flex-col gap-3"},me={class:"text-gray-400 text-sm"},ce={class:"text-sm"},pe={class:"text-sm"},ve={class:"grid grid-cols-4 gap-2 mt-2"},xe={class:"flex flex-col gap-4"},fe={class:"flex gap-4"},ye={class:"flex-1"},ge={class:"flex-1"},be={class:"flex gap-4"},_e={class:"flex-1"},we={class:"flex-1"},ke={class:"flex items-center gap-4"},Ve={class:"flex items-center gap-2"},Ce={class:"flex items-center gap-2"},$e={class:"bg-gray-900 rounded p-4 font-mono text-sm h-[500px] overflow-y-auto"},Pe={key:0,class:"text-gray-500"},Se={key:1,class:"space-y-1"},Ee={class:"text-gray-400"},Ue={class:"text-white"},Je={__name:"Control",setup(Ae){const m=c([]),S=c(!0),d=G(),D=H(),f=c(!1),y=c(!1),i=c({id:"",name:"New Proxy",listen_addr:":5020",target_addr:"127.0.0.1:502",description:"",connection_timeout:10,read_timeout:30,max_retries:3,max_read_size:0,enabled:!0,paused:!1,tags:[]}),$=c(!1),E=c(null),_=c([]),g=async()=>{try{const a=await v.get("/api/proxies");m.value=a.data}catch{console.error("Failed to fetch proxies")}};W(async()=>{await g(),S.value=!1;const{data:a,isConnected:e}=Y("/api/proxies/stream");A(e,s=>{s||console.warn("SSE connection lost, polling fallback enabled")}),A(a,s=>{if(!s)return;const r=s.type,w=s.proxy;switch(r){case"proxy_added":case"proxy_updated":case"proxy_started":case"proxy_stopped":if(w){const k=m.value.findIndex(O=>O.id===w.id);k!==-1?m.value[k]=w:m.value.push(w)}break;case"proxy_removed":s.proxy_id&&(m.value=m.value.filter(k=>k.id!==s.proxy_id));break}})}),J(()=>{});const F=()=>{y.value=!1,i.value={id:"",name:"New Proxy",listen_addr:":5020",target_addr:"127.0.0.1:502",description:"",connection_timeout:10,read_timeout:30,max_retries:3,max_read_size:0,enabled:!0,paused:!1,tags:[]},f.value=!0},z=a=>{y.value=!0,i.value={...a},f.value=!0},h=async()=>{try{y.value?(await v.put("/api/proxies",i.value),d.add({severity:"success",summary:"Success",detail:"Proxy updated",life:3e3})):(await v.post("/api/proxies",i.value),d.add({severity:"success",summary:"Success",detail:"Proxy created",life:3e3})),f.value=!1,await g()}catch(a){d.add({severity:"error",summary:"Error",detail:a.response?.data?.error||a.message,life:5e3})}},j=a=>{D.require({message:"Are you sure you want to delete this proxy?",header:"Confirm Delete",icon:"pi pi-exclamation-triangle",accept:async()=>{try{await v.delete(`/api/proxies?id=${a}`),d.add({severity:"success",summary:"Success",detail:"Proxy deleted",life:3e3}),await g()}catch(e){d.add({severity:"error",summary:"Error",detail:e.response?.data?.error||e.message,life:5e3})}}})},B=async a=>{E.value=m.value.find(e=>e.id===a);try{const s=(await v.get("/api/logs")).data;_.value=s.filter(r=>r.proxy_id===a||r.component&&r.component.includes(a))}catch(e){console.error("Failed to fetch logs",e),_.value=[]}$.value=!0},M=a=>new Date(a).toLocaleString("de-DE",{hour:"2-digit",minute:"2-digit",second:"2-digit"}),q=a=>{switch(a){case"INFO":return"text-green-400";case"WARN":return"text-yellow-400";case"ERROR":return"text-red-400";case"FATAL":return"text-red-600";default:return"text-gray-400"}},P=async(a,e)=>{try{await v.post("/api/proxies/control",{id:a,action:e}),d.add({severity:"success",summary:"Success",detail:`Proxy ${e} command sent`,life:3e3}),setTimeout(g,500)}catch(s){d.add({severity:"error",summary:"Error",detail:s.response?.data?.error||s.message,life:5e3})}},U=async a=>{try{await v.post("/api/proxies/control",{action:a==="start_all"?"start_all":"stop_all"}),d.add({severity:"success",summary:"Success",detail:`All proxies ${a.replace("_all","")} command sent`,life:3e3}),setTimeout(g,500)}catch(e){d.add({severity:"error",summary:"Error",detail:e.response?.data?.error||e.message,life:5e3})}},I=a=>{switch(a){case"Running":return"success";case"Stopped":return"secondary";case"Error":return"danger";default:return"info"}};return(a,e)=>(u(),p("div",le,[t("div",ae,[e[16]||(e[16]=t("h1",{class:"text-2xl font-bold"},"Proxy Control",-1)),t("div",oe,[o(l(n),{icon:"pi pi-plus",severity:"info",label:"Add Proxy",onClick:F,class:"text-xs sm:text-sm"}),o(l(n),{icon:"pi pi-play",severity:"success",label:"Start All",onClick:e[0]||(e[0]=s=>U("start_all")),class:"text-xs sm:text-sm"}),o(l(n),{icon:"pi pi-stop",severity:"danger",label:"Stop All",onClick:e[1]||(e[1]=s=>U("stop_all")),class:"text-xs sm:text-sm"})])]),S.value?(u(),p("div",ie,[...e[17]||(e[17]=[t("i",{class:"pi pi-spin pi-spinner text-4xl"},null,-1)])])):(u(),p("div",re,[(u(!0),p(L,null,T(m.value,s=>(u(),K(l(X),{key:s.id,class:"bg-gray-800 text-white"},{title:b(()=>[t("div",ne,[t("span",{class:"text-lg truncate",title:s.name},x(s.name),9,de),o(l(Z),{severity:I(s.status),value:s.status},null,8,["severity","value"])])]),content:b(()=>[t("div",ue,[t("div",me,x(s.description||"No description"),1),t("div",ce,"Listen: "+x(s.listen_addr),1),t("div",pe,"Target: "+x(s.target_addr),1),t("div",ve,[o(l(n),{icon:"pi pi-play",severity:"success",label:"Start",disabled:s.status==="Running",onClick:r=>P(s.id,"start"),class:"text-xs sm:text-sm"},null,8,["disabled","onClick"]),o(l(n),{icon:"pi pi-stop",severity:"danger",label:"Stop",disabled:s.status==="Stopped"||s.status==="Error",onClick:r=>P(s.id,"stop"),class:"text-xs sm:text-sm"},null,8,["disabled","onClick"]),o(l(n),{icon:"pi pi-refresh",severity:"info",label:"Restart",disabled:s.status==="Stopped",onClick:r=>P(s.id,"restart"),class:"text-xs sm:text-sm"},null,8,["disabled","onClick"]),o(l(n),{icon:"pi pi-pencil",severity:"secondary",label:"Edit",onClick:r=>z(s),class:"text-xs sm:text-sm"},null,8,["onClick"])]),o(l(n),{icon:"pi pi-eye",severity:"secondary",label:"View Logs",onClick:r=>B(s.id),class:"text-xs sm:text-sm mt-2"},null,8,["onClick"]),o(l(n),{icon:"pi pi-trash",severity:"danger",label:"Delete",onClick:r=>j(s.id),class:"text-xs sm:text-sm mt-2"},null,8,["onClick"])])]),_:2},1024))),128))])),o(l(R),{visible:f.value,"onUpdate:visible":e[14]||(e[14]=s=>f.value=s),header:y.value?"Edit Proxy":"Add Proxy",modal:"",class:"w-full max-w-lg"},{footer:b(()=>[o(l(n),{label:"Cancel",severity:"secondary",onClick:e[13]||(e[13]=s=>f.value=!1)}),o(l(n),{label:y.value?"Update":"Create",onClick:h},null,8,["label"])]),default:b(()=>[t("div",xe,[t("div",null,[e[18]||(e[18]=t("label",{class:"block text-sm font-medium mb-1"},"Name",-1)),o(l(V),{modelValue:i.value.name,"onUpdate:modelValue":e[2]||(e[2]=s=>i.value.name=s),class:"w-full"},null,8,["modelValue"])]),t("div",null,[e[19]||(e[19]=t("label",{class:"block text-sm font-medium mb-1"},"Listen Address",-1)),o(l(V),{modelValue:i.value.listen_addr,"onUpdate:modelValue":e[3]||(e[3]=s=>i.value.listen_addr=s),placeholder:":5020",class:"w-full"},null,8,["modelValue"])]),t("div",null,[e[20]||(e[20]=t("label",{class:"block text-sm font-medium mb-1"},"Target Address",-1)),o(l(V),{modelValue:i.value.target_addr,"onUpdate:modelValue":e[4]||(e[4]=s=>i.value.target_addr=s),placeholder:"192.168.1.100:502",class:"w-full"},null,8,["modelValue"])]),t("div",null,[e[21]||(e[21]=t("label",{class:"block text-sm font-medium mb-1"},"Description",-1)),o(l(V),{modelValue:i.value.description,"onUpdate:modelValue":e[5]||(e[5]=s=>i.value.description=s),class:"w-full"},null,8,["modelValue"])]),t("div",fe,[t("div",ye,[e[22]||(e[22]=t("label",{class:"block text-sm font-medium mb-1"},"Connection Timeout (s)",-1)),o(l(C),{modelValue:i.value.connection_timeout,"onUpdate:modelValue":e[6]||(e[6]=s=>i.value.connection_timeout=s),min:1,class:"w-full"},null,8,["modelValue"])]),t("div",ge,[e[23]||(e[23]=t("label",{class:"block text-sm font-medium mb-1"},"Read Timeout (s)",-1)),o(l(C),{modelValue:i.value.read_timeout,"onUpdate:modelValue":e[7]||(e[7]=s=>i.value.read_timeout=s),min:1,class:"w-full"},null,8,["modelValue"])])]),t("div",be,[t("div",_e,[e[24]||(e[24]=t("label",{class:"block text-sm font-medium mb-1"},"Max Retries",-1)),o(l(C),{modelValue:i.value.max_retries,"onUpdate:modelValue":e[8]||(e[8]=s=>i.value.max_retries=s),min:0,class:"w-full"},null,8,["modelValue"])]),t("div",we,[e[25]||(e[25]=t("label",{class:"block text-sm font-medium mb-1"},"Max Read Size (0=unlimited)",-1)),o(l(C),{modelValue:i.value.max_read_size,"onUpdate:modelValue":e[9]||(e[9]=s=>i.value.max_read_size=s),min:0,class:"w-full"},null,8,["modelValue"])])]),t("div",ke,[t("div",Ve,[o(l(N),{modelValue:i.value.enabled,"onUpdate:modelValue":e[10]||(e[10]=s=>i.value.enabled=s),binary:""},null,8,["modelValue"]),e[26]||(e[26]=t("span",{class:"text-sm"},"Enabled",-1))]),t("div",Ce,[o(l(N),{modelValue:i.value.paused,"onUpdate:modelValue":e[11]||(e[11]=s=>i.value.paused=s),binary:""},null,8,["modelValue"]),e[27]||(e[27]=t("span",{class:"text-sm"},"Paused",-1))])]),t("div",null,[e[28]||(e[28]=t("label",{class:"block text-sm font-medium mb-1"},"Tags",-1)),o(l(ee),{modelValue:i.value.tags,"onUpdate:modelValue":e[12]||(e[12]=s=>i.value.tags=s),class:"w-full",placeholder:"Add tags"},null,8,["modelValue"])])])]),_:1},8,["visible","header"]),o(l(R),{visible:$.value,"onUpdate:visible":e[15]||(e[15]=s=>$.value=s),header:`Logs - ${E.value?.name}`,modal:"",class:"w-full max-w-4xl"},{default:b(()=>[t("div",$e,[_.value.length===0?(u(),p("div",Pe,"No logs available")):(u(),p("div",Se,[(u(!0),p(L,null,T(_.value,(s,r)=>(u(),p("div",{key:r,class:"border-b border-gray-700 pb-1"},[t("span",Ee,"["+x(M(s.time))+"]",1),t("span",{class:Q([q(s.level),"mx-2 font-bold"])},x(s.level),3),t("span",Ue,x(s.message),1)]))),128))]))])]),_:1},8,["visible","header"]),o(l(se)),o(l(te))]))}};export{Je as default};
